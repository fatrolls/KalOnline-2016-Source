#include "StdAfx.h"
#include "Interface.h"
#include "Deflector.h"
#include "Deflection.h"
#include "Memory.h"
#include "Hooks.h"

#include "Detours/Detours.h"

class CPlayerWrite
{
private:
	static unsigned long Hooks[];

public:
	CPlayerWrite();
	~CPlayerWrite();
};

CREATE_INTERFACE(CPlayerWrite)

unsigned long CPlayerWrite::Hooks[] =
{
	0x004076F3, 0x004079D3, 0x004082BB, 0x00408608, 0x00409D5A, 0x00409E71, 0x0040A013, 0x0040A42F, 
	0x0040A58F, 0x0040D157, 0x0040D1D6, 0x0040D2AE, 0x0040D383, 0x0040D61F, 0x0040D639, 0x004124CF, 
	0x00412842, 0x00412F99, 0x00413282, 0x004136C4, 0x004139A2, 0x004139FA, 0x00413A29, 0x00413BA5, 
	0x00413C46, 0x0041443A, 0x00414548, 0x00414A2D, 0x00414F19, 0x00415104, 0x0041514B, 0x004151E4, 
	0x00415241, 0x00415520, 0x004155D7, 0x00415897, 0x00416FA7, 0x00416FC5, 0x00417324, 0x00417342, 
	0x00417E0F, 0x00417EF1, 0x00417FEC, 0x004183D1, 0x00419664, 0x0041A8AC, 0x0041A95A, 0x0041A9FA, 
	0x0041B031, 0x0041EE9A, 0x0041FCE0, 0x00426969, 0x004269B8, 0x004269EF, 0x00426C49, 0x00426D78, 
	0x00427056, 0x00427C24, 0x00427C49, 0x00428187, 0x004281C2, 0x00428DA9, 0x004293AA, 0x004293EF, 
	0x00429771, 0x0042994A, 0x0042998F, 0x0042A161, 0x0042A1F5, 0x0042A914, 0x0042A939, 0x0042AC57, 
	0x0042ACA3, 0x0042AFC9, 0x0042B431, 0x0042B476, 0x0042B8AA, 0x0042B8EF, 0x0042BE24, 0x0042C00E, 
	0x0042C0DC, 0x0042C1FB, 0x0042C2C4, 0x0042C42A, 0x0042C584, 0x0042C5A9, 0x0042C7A7, 0x0042C7F3, 
	0x0042C848, 0x0042CA59, 0x0042CB52, 0x0042CE23, 0x0042D09B, 0x0042D127, 0x0042D4EE, 0x0042D73A, 
	0x0042D797, 0x0042D95E, 0x0042DB67, 0x0042DC0F, 0x0042DC75, 0x0042DDBD, 0x0042DF8B, 0x0042E022, 
	0x0042E356, 0x0042E3F7, 0x0042E8E4, 0x0042E909, 0x0042EB28, 0x0042EBA2, 0x0042EC7B, 0x0042EDC9, 
	0x00437FCF, 0x0043A4B9, 0x0043A577, 0x0043AB6F, 0x0043ABA1, 0x00440D24, 0x0044199C, 0x00441A9B, 
	0x00441B00, 0x00441BBF, 0x00444C66, 0x00449199, 0x00449211, 0x00449288, 0x004499D6, 0x00449A1E, 
	0x00449D11, 0x00449DB4, 0x00449F34, 0x00449FCC, 0x0044A077, 0x0044A186, 0x0044A568, 0x0044A59D, 
	0x0044A5DB, 0x0044A618, 0x0044A681, 0x0044A6FE, 0x0044A780, 0x0044A7FD, 0x0044A84A, 0x0044A8D9, 
	0x0044A924, 0x0044A998, 0x0044A9C8, 0x0044AA31, 0x0044AA9E, 0x0044AB56, 0x0044ABA4, 0x0044AD19, 
	0x0044D5FC, 0x0044DA5B, 0x0044DAFD, 0x0044DBEF, 0x0044DCB7, 0x0044DD0D, 0x0044DEAA, 0x0044DF7D, 
	0x00451375, 0x004513E3, 0x004514A1, 0x004514D3, 0x004519ED, 0x00451A68, 0x00451D0A, 0x00451DC8, 
	0x00451E5D, 0x00451E98, 0x00451F31, 0x00452469, 0x0045249A, 0x004529EB, 0x00452A51, 0x00452F88, 
	0x00453031, 0x0045304B, 0x004530CD, 0x004530E7, 0x004536E7, 0x00453834, 0x00453931, 0x00453950, 
	0x00453A71, 0x00454394, 0x004546B6, 0x004546DF, 0x004546F9, 0x00454875, 0x00455574, 0x00455C10, 
	0x00455C52, 0x00455CD4, 0x00455D1C, 0x00455D94, 0x00455DD6, 0x00455E03, 0x00455FE3, 0x00455FFB, 
	0x004560F4, 0x0045610C, 0x00456CBE, 0x004570A8, 0x00457A3F, 0x00458175, 0x004581B8, 0x004581E5, 
	0x00458358, 0x0045846E, 0x00458965, 0x00458AA7, 0x00458C81, 0x00458E05, 0x00458F6E, 0x0045903B, 
	0x0045911B, 0x00459183, 0x004591EB, 0x00459311, 0x004593D7, 0x0045952D, 0x00459556, 0x0045957F, 
	0x004595A6, 0x00459674, 0x00459783, 0x00459A8E, 0x00459CA8, 0x00459FDF, 0x0045A301, 0x0045A56F, 
	0x0045A61C, 0x0045A6D3, 0x0045A72E, 0x0045A789, 0x0045A7F0, 0x0045A857, 0x0045A903, 0x0045A96A, 
	0x0045A9D1, 0x0045AA7D, 0x0045AB22, 0x0045AB89, 0x0045ABF9, 0x0045AC6B, 0x0045ACDD, 0x0045AD4F, 
	0x0045ADC1, 0x0045AE33, 0x0045AF91, 0x0045B051, 0x0045B361, 0x0045B587, 0x0045B8CA, 0x0045BBF8, 
	0x0045BE72, 0x0045BF2B, 0x0045BFEE, 0x0045C05F, 0x0045C0C6, 0x0045C12D, 0x0045C194, 0x0045C240, 
	0x0045C2A7, 0x0045C30E, 0x0045C3BA, 0x0045C45F, 0x0045C4C6, 0x0045C537, 0x0045CD44, 0x0045CD6B, 
	0x0045CF4E, 0x0045D3B8, 0x0045D5F7, 0x0045DBC2, 0x0045DECA, 0x0045E1A7, 0x0045E28C, 0x0045E2A3, 
	0x0045E2C2, 0x0045E370, 0x0045E387, 0x0045E426, 0x0045E4E6, 0x0045E694, 0x0045EA9F, 0x0045ED0C, 
	0x0045EF26, 0x0045F067, 0x0045F0A2, 0x0045F3C9, 0x0045F528, 0x0045F685, 0x0045F6BB, 0x0045F6E5, 
	0x0045F791, 0x0045F7CA, 0x0045F836, 0x0045FB0E, 0x0045FB51, 0x0045FB80, 0x0045FBAB, 0x0045FBF9, 
	0x0045FC15, 0x0045FC33, 0x0045FD02, 0x0045FD19, 0x0045FD30, 0x0045FD59, 0x0045FFCB, 0x0046008B, 
	0x004602EC, 0x0046033B, 0x004603AA, 0x00460409, 0x00460442, 0x0046045E, 0x004604FB, 0x0046056A, 
	0x004605C9, 0x00460605, 0x0046064D, 0x00460694, 0x00460720, 0x00460740, 0x00460800, 0x004608BC, 
	0x004608E9, 0x0046090B, 0x00460929, 0x00460961, 0x00460981, 0x004609DC, 0x00460A36, 0x00460C7D, 
	0x00460C9B, 0x00460CC4, 0x00460DF4, 0x00460EF6, 0x0046118F, 0x00461211, 0x004612DD, 0x00461358, 
	0x004613FC, 0x00461461, 0x004614DE, 0x0046155B, 0x00461685, 0x00461754, 0x004617A0, 0x00461962, 
	0x00461A2F, 0x00461D6A, 0x00461E75, 0x00461F13, 0x00462013, 0x004621EE, 0x00462292, 0x00462321, 
	0x004623E9, 0x00462433, 0x00462711, 0x0046282E, 0x004633A7, 0x00463709, 0x0046394A, 0x00464033, 
	0x004647F8, 0x00464832, 0x00464AF0, 0x00464B13, 0x00464BA4, 0x00464BEA, 0x00464C25, 0x00464CBB, 
	0x00464D23, 0x00464DC5, 0x00464E28, 0x00464E78, 0x00464F7F, 0x00464FEA, 0x004651A9, 0x004651F1, 
	0x0046520F, 0x0046557D, 0x00465595, 0x00465A42, 0x00465A98, 0x00465B14, 0x00465B67, 0x00465B93, 
	0x00465C22, 0x0046629A, 0x004662BD, 0x004662D8, 0x004662F4, 0x004663D5, 0x004663FD, 0x004664F3, 
	0x00466594, 0x0046667F, 0x0046687F, 0x004668AB, 0x0046695E, 0x00466A7E, 0x00466EF0, 0x00467353, 
	0x0046738D, 0x00467699, 0x0046778B, 0x004677AB, 0x00467A8F, 0x00467AED, 0x00467C26, 0x00467C49, 
	0x00467EBB, 0x00467F41, 0x00468319, 0x00468394, 0x004683FA, 0x00468831, 0x0046886A, 0x00468A36, 
	0x00468E50, 0x00469170, 0x0046921A, 0x0046933B, 0x00469382, 0x004694A1, 0x004695C9, 0x0046973F, 
	0x00469786, 0x00469A4E, 0x00469A71, 0x00469AB7, 0x0046B127, 0x0046B15A, 0x0046B2A2, 0x0046B74A, 
	0x0046BA8D, 0x0046BABC, 0x0046BB3D, 0x0046C33C, 0x0046C3F8, 0x0046C469, 0x0046C635, 0x0046C6B2, 
	0x0046C9A3, 0x0046C9BC, 0x0046CDBF, 0x0046CED5, 0x0046CF2A, 0x0046CF56, 0x0046CFEC, 0x0046D0E7, 
	0x0046D135, 0x0046D170, 0x0046D1C8, 0x0046D1F4, 0x0046D28C, 0x0046D324, 0x0046D47E, 0x0046DA2E, 
	0x0046DA81, 0x0046DAD2, 0x0046DB0B, 0x0046DB5E, 0x0046DD2D, 0x0046ECBD, 0x0046ED00, 0x0046EE18, 
	0x0046EE7B, 0x00470136, 0x00470250, 0x0047029F, 0x004702BD, 0x0047AD69, 0x0047ADD6, 0x0047B17E, 
	0x0047F8D5, 0x0047FA21, 0x0047FB47, 0x004807A0, 0x004810E7, 0x004811AA, 0x00483AF4, 0x004869B2, 
	0x00489B06, 0x0048B2B4, 0x0048C2B8, 0x0048C4B8, 0x0048C7B8, 0x0048CD80, 0x0048D378, 0x00491578, 
	0x00493A70, 0x00496760, 0x00496775, 0x0049679B, 0x004967C1, 0x00496841, 0x0049685F, 0x004969CD, 
};

CPlayerWrite::CPlayerWrite()
{
	Interface<IDeflector> Deflector;
	Interface<IMemory> Memory;
	Interface<CPlayerWrite>::Ephemeralize();
	Deflector->Implement(Deflection::CPlayerWrite, 4);
}

CPlayerWrite::~CPlayerWrite()
{
	Interface<IMemory> Memory;
	Memory->Restore(CPlayerWrite::Hooks, sizeof(CPlayerWrite::Hooks)/4);
}